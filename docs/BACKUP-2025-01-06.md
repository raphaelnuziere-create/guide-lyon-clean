# üîí BACKUP GUIDE DE LYON - 6 Janvier 2025

## üìå √âtat actuel du projet

### ‚úÖ Ce qui fonctionne parfaitement :

#### 1. **Authentification Professionnelle**
- ‚úÖ Inscription sur `/pro/inscription` avec email/password
- ‚úÖ Connexion sur `/connexion/pro`
- ‚úÖ Dashboard sur `/pro/dashboard`
- ‚úÖ Compte test fonctionnel :
  - Email : `merchant@guide-de-lyon.fr`
  - Mot de passe : `Merchant2025!`

#### 2. **Base de donn√©es Supabase**
- Table `establishments` op√©rationnelle
- Table `subscription_plans` avec 3 plans (Basic, Pro, Expert)
- RLS (Row Level Security) configur√©
- Authentification Supabase active

#### 3. **Architecture technique**
- Next.js 15.5.2 avec App Router
- TypeScript
- Tailwind CSS
- Supabase pour auth et BDD
- D√©ploy√© sur Vercel : www.guide-de-lyon.fr

### üìÇ Structure des fichiers importants :

```
/app
  /pro
    /dashboard/page.tsx      ‚Üê Dashboard professionnel
    /inscription/page.tsx    ‚Üê Formulaire inscription 3 √©tapes
  /connexion
    /pro/page.tsx           ‚Üê Page connexion professionnelle
  /auth
    /callback/route.ts      ‚Üê Gestion confirmation email

/lib
  /auth
    /AuthContext.tsx        ‚Üê Context authentification centralis√©
    /supabase-auth.ts      ‚Üê Client Supabase

/scripts
  /create-merchant-establishment.js  ‚Üê Cr√©er √©tablissement test
  /clean-duplicate-establishments.js ‚Üê Nettoyer doublons
  /test-merchant-login.js           ‚Üê Tester connexion
```

### üîë Variables d'environnement essentielles :

```env
NEXT_PUBLIC_SUPABASE_URL=https://ikefyhxelzydaogrnwxi.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlrZWZ5aHhlbHp5ZGFvZ3Jud3hpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2OTY3NTQsImV4cCI6MjA3MTI3Mjc1NH0.vJHDlWKUK0xUoXB_CCxNkVNnWhb7Wpq-mA097blKmzc
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlrZWZ5aHhlbHp5ZGFvZ3Jud3hpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NTY5Njc1NCwiZXhwIjoyMDcxMjcyNzU0fQ.Ink48F4a18sn-nbcKBbxwBCRA9Yur1z1_vmrR_Ku47Y
```

### üîß Derni√®res corrections appliqu√©es :

1. **Inscription simplifi√©e** :
   - Supprim√© TVA/SIRET obligatoires
   - Ajout√© champs email/password √† l'√©tape 2
   - Redirection directe vers dashboard apr√®s inscription

2. **Correction boucle de redirection** :
   - Dashboard avec retry pour charger √©tablissement
   - AuthContext ne bloque plus pendant le chargement
   - Session forc√©e apr√®s inscription

3. **Compte test merchant** :
   - Nettoy√© 4 √©tablissements dupliqu√©s
   - Cr√©√© √©tablissement unique "Restaurant Test Lyon"
   - Scripts de maintenance pour √©viter futurs probl√®mes

### üöÄ Commandes utiles :

```bash
# D√©veloppement local
npm run dev

# Build production
npm run build

# Tester compte merchant
node scripts/test-merchant-login.js

# Nettoyer doublons si besoin
node scripts/clean-duplicate-establishments.js
```

### üìù Plans d'abonnement configur√©s :

1. **Basic (Gratuit)** :
   - 1 √©v√©nement/mois
   - 3 photos max
   - Description 200 caract√®res

2. **Pro (19‚Ç¨/mois)** :
   - 4 √©v√©nements/mois
   - 6 photos max
   - Description 500 caract√®res
   - Newsletter

3. **Expert (49‚Ç¨/mois)** :
   - √âv√©nements illimit√©s
   - 15 photos max
   - Description 1500 caract√®res
   - Newsletter + Premium

### ‚ö†Ô∏è Points d'attention :

1. **Emails Supabase** : Configurer les redirect URLs dans Supabase Dashboard
2. **Table subscriptions** : Non cr√©√©e (optionnelle pour l'instant)
3. **Stripe** : Int√©gration √† faire pour les paiements

### üìÖ Historique des commits importants :

- `bb4621f` : Fix compte test merchant + scripts maintenance
- `63b7aee` : Fix champs email/password manquants
- `dbfb13f` : Fix boucle redirection apr√®s inscription
- `e701dba` : Configuration Email Professionnelle Compl√®te

### üéØ Prochaines √©tapes sugg√©r√©es :

1. Int√©grer Stripe pour les paiements
2. Cr√©er interface gestion √©v√©nements
3. Syst√®me upload photos
4. Newsletter avec Brevo
5. Page publique √©tablissements

---

## üíæ Ce backup contient l'√©tat STABLE et FONCTIONNEL du projet

Si besoin de revenir √† cet √©tat :
```bash
git checkout bb4621f
```

Date du backup : **6 Janvier 2025, 14h26**
Dernier commit : **bb4621f**